# 第3章 コンテナーの管理

## コンテナーのライフサイクルの管理

#### Podman によるコンテナーのライフサイクル管理

Podman では、コンテナーを実行するだけでなく、コンテナーをバックグラウンドで実行し、その内部で新しいプロセスを実行し、ファイルシステムボリュームやネットワークなどのリソースをコンテナーに提供することもできます。 

コンテナーを作成および管理するためのサブコマンドセットがあります。開発者はこれらのサブコマンドを使用して、コンテナーおよびコンテナーイメージのライフサイクルを管理します。

コンテナーとイメージの状態を変更するサブコマンドで最も使用頻度の高いものについて、次の図に概要を示します。 

![image1](images/image1.png)


Podman は、実行中および停止中のコンテナーに関する情報を入手するための便利なサブコマンドも提供します。 これらのサブコマンドを使用して、デバッグ、更新、または報告を行うためにコンテナーおよびイメージから情報を抽出することができます。

コンテナーとイメージの情報をクエリーするサブコマンドで最も使用頻度の高いものについて、次の図に概要を示します。 

![image2](images/image2.png)


- [マニュアル：第8章 コンテナーのコマンドライン参照](https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/container-command-line-reference_building-running-and-managing-containers)


#### コンテナーの作成

- podman run

イメージから新しいコンテナーを作成し、新しいコンテナー内でプロセスを開始します。

コンテナーイメージがローカルで利用できない場合、このコマンドは設定されたイメージリポジトリを使用してイメージをダウンロードしようとします。

- podman ps 

**Podman は、固有のコンテナー ID またはコンテナー名によってコンテナーを識別します。** podman ps コマンドで確認可能

コンテナーID：一意であり、自動的に作成

コンテナー名は手動で指定(podman run --nameオプション)できます。指定しない場合は自動的に生成されます。この名前は一意である必要があります。


- エントリーポイントのオーバーライド
コンテナーイメージは、エントリーポイントとして知られるコンテナー化プロセスを開始するために実行するコマンドを指定します。**podman run コマンドは、コンテナーイメージの後にコマンドを含めることで、このエントリーポイントをオーバーライドできます。**

ex) コンテナーイメージ内で実行可能なコマンドを指定できる。**ただし、コンテナーは httpd イメージのエントリーポイントをスキップします。そのため httpd サービスは起動しません。**
```
[student@workstation ~]$ sudo podman run rhscl/httpd-24-rhel7 ls /tmp
anaconda-post.log
ks-script-1j4CXN
yum.log
```


## コンテナーでのコマンドの実行 

- 使用例
    - すでに実行中のコンテナーで対話的なシェルを実行する。(/bin/bash)
    - コンテナーのファイルを更新または表示する(ls)プロセスを実行する。
    - コンテナー内で新しいバックグラウンドプロセスを開始する


#### 実行中のコンテナーでのコマンド実行

- podman exec 

ex1) 
```
[student@workstation ~]$ sudo podman exec 7ed6e671a600 cat /etc/hostname
7ed6e671a600
```

ex2) 対話型
```
[student@workstation ~]$ sudo podman run -it rhscl/httpd-24-rhel7 /bin/bash
bash-4.2#
```

#### -it オプションについてのメモ

-i および -t オプションは、対話的なテキストベースのプログラムのターミナルリダイレクトを有効にします。-t オプションは pseudo-tty (ターミナル) を割り当て、それをコンテナーの標準入力にアタッチします。-i オプションは、コンテナーが切り離されていても標準入力をオープンに保つので、メインプロセスは入力を待機し続けることができます。 


#### 実行しないで、コンテナーへのコマンド実行

ex) 詳細は上記参照
```
[student@workstation ~]$ sudo podman run rhscl/httpd-24-rhel7 ls /tmp
anaconda-post.log
ks-script-1j4CXN
yum.log
```


## コンテナーの管理

コンテナーの作成と起動は、コンテナーのライフサイクルの最初の手順にすぎません。

コンテナーのライフサイクルには、コンテナーの停止、再起動、または最終的な削除も含まれます。

- podman inspect
- podman stop
- podman kill (終了)
    - -s オプションでシグナルを指定できます。(たくさんある。)
    - [3.3. コンテナーの起動および停止](https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/8/html/building_running_and_managing_containers/starting-and-stopping-containers_building-running-and-managing-containers#stopping-containers_building-running-and-managing-containers)
- podman restart
- podman rm 
    - -f 起動中でも強制削除
    - -a 全削除


## ガイド付き演習: MySQL コンテナーの管理

