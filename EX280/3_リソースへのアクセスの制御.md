# 3_リソースへのアクセスの制御


## ロールベースのアクセス制御(RBAC)を定義する

**RBACとは、コンピューターシステム内のリソースへのアクセスを管理するための手法**

認可プロセスは、ルール、ロール、およびバインディングによって管理

```
ルール：許可されるアクション
ロール：ルールのセット
バインディング：ロールとユーザー・グループの結びつけ
```

デフォルトのロール

```
admin：このロールのユーザーは、プロジェクトへのアクセス権を他のユーザーに付与するなど、すべてのプロジェクトリソースを管理できます。

basic-user：このロールのユーザーには、プロジェクトの読み取りアクセス権があります。

cluster-admin：このロールのユーザーには、クラスターリソースへのスーパーユーザーアクセス権があります。これらのユーザーは、クラスター上であらゆるアクションを実行でき、すべてのプロジェクトの完全制御権を持っています。

cluster-status：このロールのユーザーは、クラスターのステータス情報を取得できます。

edit：このロールのユーザーは、サービスやデプロイ設定など、プロジェクトから共通のアプリケーションリソースを作成、変更、削除できます。これらのユーザーが制限範囲やクォータなどの管理リソースを操作したりプロジェクトへのアクセス権を管理したりすることはできません。

self-provisioner：このロールのユーザーは、新しいプロジェクトを作成できます。これはクラスターロールであり、プロジェクトロールではありません。

view：このロールのユーザーは、プロジェクトリソースを表示できますが、プロジェクトリソースを変更することはできません。 
```

### ガイド付き演習: RBAC を使用したパーミッションの定義と適用

- 現在のプロジェクトに対するロールバインディングを一覧表示
```
$ oc get rolebindings -o wide
```

- self-provisioner クラスターロールを参照するすべてのクラスターロールバインディングを一覧表示
```
$ oc get clusterrolebinding -o wide | grep -E 'NAME|self-provisioner'
```

- self-provisioner クラスターロールが system:authenticated:oauth グループに割り当てられていることを確認
```
$ oc describe clusterrolebindings self-provisioners

出力例)
Name:         self-provisioners
Labels:       <none>
Annotations:  <none>
Role:
  Kind:  ClusterRole
  Name:  self-provisioner
Subjects:
  Kind   Name                        Namespace
  ----   ----                        ---------
  Group  system:authenticated:oauth                  <- これ
```

- self-provisioner クラスターロールを system:authenticated:oauth 仮想グループから削除 -> self-provisioners ロールバインディングが削除
```
$ oc adm policy remove-cluster-role-from-group self-provisioner system:authenticated:oauth
```

- プロジェクト作成権限をすべてのユーザーに復元
    - adminユーザーでログイン
```
$ oc adm policy add-cluster-role-to-group --rolebinding-name self-provisioners(クラスターロールバインディング名) self-provisioner(ロール名) system:authenticated:oauth
```


## ユーザーにアクセス許可を適用する

- 現在のプロジェクトに対しての管理者権限をleaderユーザーに追加
```
$ oc adm policy add-role-to-user admin leader
```


## 機密情報を管理するためのシークレットを作成して適用する





## セキュリティコンテキストの制約(SCC)を使用してサービスアカウントを作成し、アクセス許可を適用する

**リソースへのアクセスは制限するが OpenShiftの操作は制限しないセキュリティー方式**

